{{ assign 'natural_height' false }}
{{ assign 'natural_mobile_height' false }}
<script type="text/json" id="Slideshow-data-{{ section.id }}">{{{ stringify section.settings }}}</script>
<script type="text/json" id="Slideshow-data-block-{{ section.id }}">{{{ stringify section.blocks }}}</script>

<div
  data-section-type="slideshow"
  data-section-id="{{ section.id }}"
>
  {{#if (obj_size section.blocks) '>' 0}}
    {{ assign 'natural_height_ratio' 0 }}
    {{ assign 'natural_mobile_height_ratio' 0 }}
    {{#if (boolean (boolean section.settings.section_height '==' 'natural') '||' (boolean section.settings.mobile_height '==' 'auto'))}}

      {{#with this as |global|}}
        {{#forIn section.blocks}}
          {{#if @index '===' 0}}
            {{#if (boolean this.settings.image.url '&&' (boolean global.section.settings.section_height '===' 'natural'))}}
              {{#with global}}
                {{ assign 'natural_height' true }}
              {{/with}}
              {{#if this.settings.image.scale}}
                {{ assign 'natural_height_ratio' (multiply (divide this.settings.image.height this.settings.image.width) 100) }}
                {{#style}}
                  @media only screen and (min-width: 750px) {
                    .natural--{{global.section.id}} {
                      padding-top: {{natural_height_ratio}}% !important;
                    }
                  }
                {{/style}}
              {{/if}}
            {{/if}}
            {{#if (boolean global.section.settings.mobile_height '===' 'auto')}}
              {{#with global}}
                {{ assign 'natural_mobile_height' true }}
              {{/with}}
              {{#if (isTruthy this.settings.image_mobile.url )}}
                {{!-- 配了m端图片， 用m端的scale --}}
                {{ assign 'natural_mobile_height_ratio' (multiply (divide this.settings.image_mobile.height this.settings.image_mobile.width) 100) }}
              {{else if (boolean (isTruthy this.settings.image.url ) '&&' (isFalsey this.settings.image_mobile.url))}}
                {{!-- 配了pc的图片， m端图片没配， 用pc的scale --}}
                {{ assign 'natural_mobile_height_ratio' (multiply (divide this.settings.image.height this.settings.image.width) 100) }}
              {{/if}}
              
              {{#if (boolean this.settings.image.url '||' this.settings.image_mobile.url)}}
                {{#style}}
                  @media only screen and (max-width: 749px) {
                    .natural-mobile--{{global.section.id}} {
                      padding-top: {{ natural_mobile_height_ratio }}% !important;
                    }
                  }
                {{/style}}
              {{/if}}
            {{/if}}
          {{/if}}
        {{/forIn}}
      {{/with}}
    {{/if}}
    
    <div
      class="slideshow-wrapper flickity-viewport {{#if natural_height}}natural--{{ section.id }} is-natural{{/if}} {{#if natural_mobile_height}}natural-mobile--{{ section.id }} is-natural-mobile{{/if}}"
    >
      <div
        id="Slideshow-{{ section.id }}"
        class="hero hero--h{{ section.settings.section_height }} hero--mobile-{{ section.settings.mobile_height }} loading loading--delayed"
      >
        <div class="flickity-slider">

          {{#with this as |global|}}
            {{#forIn section.blocks}}
              {{ assign 'has_mobile_image' false }}
              {{#if this.settings.image_mobile.url}}
                {{ assign 'has_mobile_image' true }}
              {{/if}}
              {{#style}}
                {{ assign 'button_alpha' (color_extract this.settings.color_accent 'alpha') }}
                {{ assign 'overlay_opacity' (default this.settings.overlay_opacity 0 ) }}

                .slideshow__slide--{{ @key }} .hero__image-wrapper:after {
                  opacity: {{ divide overlay_opacity 100 }};
                }
                .slideshow__slide--{{ @key }} .hero__image {
                  object-position: {{ this.settings.focal_point }};
                }
                .slideshow__slide--{{ @key }} .hero__title {
                  font-size: {{ this.settings.title_size }}px;
                }
                @media only screen and (max-width: 749px) {
                  .slideshow__slide--{{ @key }} .hero__title {
                    font-size: {{ multiply this.settings.title_size 0.5 }}px;
                  }
                }

                {{#if button_alpha '>' 0}}
                  .slideshow__slide--{{ @key }} .btn-lg {
                    background-color: {{ this.settings.color_accent }};
                    border: none;
                    color: #fff;
                    {{#if (color_extract this.settings.color_accent 'lightness') '>' 40}}
                      color: #000 !important;
                    {{/if}}
                  }
                {{/if}}
              {{/style}}

              {{assign 'link_item' (useLink this.settings.link global.request.uri.query)}}
              {{assign 'link_2_item' (useLink this.settings.link_2 global.request.uri.query)}}
              {{assign 'ele_link_item' (JSONparse '{}')}}
              {{assign 'ele' 'div'}}
              {{#and (and (and (isFalsey this.settings.link_text) (isFalsey this.settings.link_text_2)) (or this.settings.link this.settings.link_2))}}
                {{assign 'ele' 'a'}}
                {{assign 'ele_link_item' link_item}}
                {{#if (isFalsey this.settings.link)}}
                  {{assign 'ele_link_item' link_2_item}}
                {{/if}}
              {{/and}}

              <{{ele}}
                {{#eq ele 'a'}}
                  {{{ele_link_item.hrefAttr}}}
                {{/eq}}
                class="slideshow__slide swiper-slide slideshow__slide--{{ @key }}"
              >
                <div class="hero__image-wrapper">
                  {{#if global.section.settings.parallax}}
                  <div class="parallax-container">
                    <div class="parallax">
                  {{/if}}
                    {{ assign 'has_image' false }}
                    {{#if this.settings.image.url}}
                      {{ assign 'has_image' true }}
                    {{/if}}
                    {{#if this.settings.image_mobile.url}}
                      {{ assign 'has_image' true }}
                    {{/if}}
                    {{#if has_image}}
                      {{ assign 'srcset_w' '180,360,540,720,900,1080,1296,1512,1728,1944,2160,2376,2592' }}
                      {{ assign 'srcset_w_result' (split srcset_w ',') }}
                      
                      {{#if this.settings.image.url}}
                        {{ assign 'image_srcset' '' }}
                        {{#with this as |eachThis|}}
                          {{#eachIndex eachThis.srcset_w_result}}
                            {{#with this as | itemThis |}}
                              {{#with eachThis}}
                                {{ assign 'image_srcset' (append image_srcset (img_url eachThis.settings.image.url width=itemThis.item)) }}
                                {{ assign 'image_srcset' (append image_srcset (append ' ' (append itemThis.item 'w'))) }}
                                {{ assign 'image_srcset' (append image_srcset ',') }}
                              {{/with}}
                            {{/with}}
                          {{/eachIndex}}
                        {{/with}}
                        <img
                          class="hero__image lozad {{#if has_mobile_image}}d-none d-md-block{{/if}}"
                          data-src="{{ this.settings.image.url }}"
                          data-srcset="{{ image_srcset }}"
                          alt="{{ this.settings.image.alt }}"
                          data-aspectratio-url="{{ img_url this.settings.image.url width=100 }}"
                          data-aspectratio={{ this.settings.image.scale }}
                        >
                      {{else}}
                        {{ snippet 'icons/icon_slideshow_placeholder' class="d-none d-md-block" }}
                      {{/if}}
                      {{#if this.settings.image_mobile.url}}
                        {{ assign 'image_mobile_srcset' '' }}
                        {{#with this as |eachThis|}}
                          {{#eachIndex eachThis.srcset_w_result}}
                            {{#with this as | itemThis |}}
                              {{#with eachThis}}
                                {{ assign 'image_mobile_srcset' (append image_mobile_srcset (img_url eachThis.settings.image_mobile.url width=itemThis.item)) }}
                                {{ assign 'image_mobile_srcset' (append image_mobile_srcset (append ' ' (append itemThis.item 'w'))) }}
                                {{ assign 'image_mobile_srcset' (append image_mobile_srcset ',') }}
                              {{/with}}
                            {{/with}}
                          {{/eachIndex}}
                        {{/with}}
                        <img
                          class="hero__image lozad hero__image--mobile d-md-none"
                          data-src="{{ this.settings.image_mobile.url }}"
                          data-srcset="{{ image_mobile_srcset }}"
                          alt="{{ this.settings.image_mobile.alt }}"
                          data-aspectratio-url="{{ img_url this.settings.image_mobile.url width=100 }}"
                          data-aspectratio={{ this.settings.image_mobile.scale }}
                        />
                      {{/if}}
                      
                    {{else}}
                      {{ snippet 'icons/icon_slideshow_placeholder' class="d-none d-md-block" }}
                      {{ snippet 'icons/icon_slideshow_mobile_placeholder' class="d-md-none" }}
                    {{/if}}
                  {{#if global.section.settings.parallax}}
                    </div>
                  </div>
                  {{/if}}
                </div>

                {{ assign 'hero_text' false }}
                {{#if (boolean_some this.settings.top_subheading this.settings.title this.settings.subheading this.settings.link_text this.settings.link_text_2)}}
                  {{ assign 'hero_text' true }}
                {{/if}}
                {{#if hero_text}}
                  <div class="hero__text-wrap">
                    <div class="container g-4 g-md-6">
                      <div class="hero__text-content {{ this.settings.text_align }}">
                        <div class="hero__text-shadow">
                          {{#if this.settings.top_subheading}}
                            <div class="hero__top-subtitle body3">
                              <div class="animation-cropper">
                                <div class="animation-contents">{{ this.settings.top_subheading }}</div>
                              </div>
                            </div>
                          {{/if}}
                          {{#if this.settings.title}}
                          
                            <h2 class="title1 hero__title {{#if global.theme.settings.type_title_uppercase}}is-uppercase{{/if}}">
                              <div class="animation-cropper">
                                <div class="animation-contents">{{ newline_to_br this.settings.title }}</div>
                              </div>
                            </h2>
                          {{/if}}
                          {{#if this.settings.subheading}}
                            <div class="hero__subtitle body1">
                              <div class="animation-cropper">
                                <div class="animation-contents">{{ this.settings.subheading }}</div>
                              </div>
                            </div>
                          {{/if}}
                          {{ assign 'has_link' false }}
                          {{#if this.settings.link_text}}
                            {{ assign 'has_link' true }}
                          {{/if}}
                          {{#if this.settings.link_text_2}}
                            {{ assign 'has_link' true }}
                          {{/if}}
                          {{#if has_link}}
                            <div class="hero__link">
                              {{#if this.settings.link_text}}
                                <a {{{ link_item.hrefAttr }}} class="btn btn-lg btn-primary body2 {{#contains this.settings.color_accent 'rgba(0,0,0,0)'}}btn--inverse{{/contains}}">{{ this.settings.link_text }}</a>
                              {{/if}}
                              {{#if this.settings.link_text_2}}
                                <a {{{ link_2_item.hrefAttr }}} class="btn btn-lg btn-primary body2 {{#contains this.settings.color_accent 'rgba(0,0,0,0)'}}btn--inverse{{/contains}}">{{ this.settings.link_text_2 }}</a>
                              {{/if}}
                            </div>
                          {{/if}}
                        </div>
                      </div>
                    </div>
                  </div>
                {{/if}}
              </{{ele}}>
            {{/forIn}}
          {{/with}}

        </div>
        {{#if section.settings.style '===' 'arrows'}}
          <div class="flickity-button flickity-button--next">
            {{ snippet 'icons/icon_strong_arrow_r' class="flickity-button__icon" }}
          </div>
          <div class="flickity-button flickity-button--prev">
            {{ snippet 'icons/icon_strong_arrow_r' class="flickity-button__icon" }}
          </div>
        {{/if}}
        {{ assign 'pagination' false }}
        {{#if section.settings.style '===' 'dots'}}
          {{ assign 'pagination' true }}
        {{/if}}
        {{#if section.settings.style '===' 'bars'}}
          {{ assign 'pagination' true }}
        {{/if}}
        {{#if (boolean section.settings.autoplay '&&' (boolean section.settings.style '===' 'bars'))}}
        {{#style}}

          .swiper-pagination--{{ section.id }} .swiper-pagination-bullet:after {
            animation-duration: {{ multiply section.settings.autoplay_speed 1000 }}ms !important;
          }
        {{/style}}
        {{/if}}
        {{#if pagination}}
          <div class="swiper-pagination swiper-pagination--{{ section.id }} {{#if section.settings.style '===' 'bars'}}swiper-pagination--bars{{/if}}"></div>
        {{/if}}
      </div>
    </div>
  {{else}}
    <div class="placeholder-noblocks">This section doesn’t currently include any content. Add content to this section using the sidebar.</div>
  {{/if}}
</div>

{{#schema}}
  {
    "name": {
      "zh-hans-cn": "轮播图",
      "en": "Slideshow"
    },
    "class": "index-section--hero",
    "block_info": {
      "zh-hans-cn": "[查看模板图片的建议尺寸](https://shoplineapphelp.zendesk.com/hc/articles/4406422263577)",
      "en": "[View the suggested sizes of image templates](https://shoplineapphelp.zendesk.com/hc/articles/4406422263577)"
    },
    "max_blocks": 5,
    "settings": [
      {
        "type": "select",
        "id": "section_height",
        "label": {
          "zh-hans-cn": "电脑端高度",
          "en": "Height on PC"
        },
        "default": "750px",
        "options": [
          {
            "label": {
              "zh-hans-cn": "适应第一张图片尺寸",
              "en": "Adapt to first image"
            },
            "value": "natural"
          },
          {
            "label": "450px",
            "value": "450px"
          },
          {
            "label": "550px",
            "value": "550px"
          },
          {
            "label": "650px",
            "value": "650px"
          },
          {
            "label": "750px",
            "value": "750px"
          },
          {
            "label": {
              "zh-hans-cn": "全屏",
              "en": "Full screen"
            },
            "value": "100vh"
          }
        ]
      },
      {
        "type": "select",
        "id": "mobile_height",
        "label": {
          "zh-hans-cn": "移动端高度",
          "en": "Height on mobile device"
        },
        "default": "auto",
        "options": [
          {
            "label": {
              "zh-hans-cn": "适应第一张图片尺寸",
              "en": "Adapt to first image"
            },
            "value": "auto"
          },
          {
            "label": "250px",
            "value": "250px"
          },
          {
            "label": "300px",
            "value": "300px"
          },
          {
            "label": "400px",
            "value": "400px"
          },
          {
            "label": "500px",
            "value": "500px"
          },
          {
            "label": {
              "zh-hans-cn": "全屏",
              "en": "Full screen"
            },
            "value": "100vh"
          }
        ]
      },
      {
        "type": "switch",
        "id": "parallax",
        "label": {
          "zh-hans-cn": "启用滚动视差效果",
          "en": "Enable the parallax scroll"
        },
        "info": {
          "zh-hans-cn": "开启视差效果会裁减部分图片以达到效果",
          "en": "When enabling the parallax effect, part of the image will be cropped to ensure the correct display."
        },
        "default": true
      },
      {
        "type": "select",
        "id": "style",
        "label": {
          "zh-hans-cn": "翻页样式",
          "en": "Style of turning pages"
        },
        "default": "arrows",
        "options": [
          {
            "value": "minimal",
            "label": {
              "zh-hans-cn": "简单",
              "en": "Minimal"
            }
          },
          {
            "value": "arrows",
            "label": {
              "zh-hans-cn": "箭头",
              "en": "Arrows"
            }
          },
          {
            "value": "bars",
            "label": {
              "zh-hans-cn": "进度条",
              "en": "Bars"
            }
          },
          {
            "value": "dots",
            "label": {
              "zh-hans-cn": "小圆点",
              "en": "Dots"
            }
          }
        ]
      },
      {
        "type": "switch",
        "id": "autoplay",
        "label": {
          "zh-hans-cn": "启用自动切换",
          "en": "Enable the auto-switching"
        },
        "default": true
      },
      {
        "type": "range",
        "id": "autoplay_speed",
        "label": {
          "zh-hans-cn": "切换间隔",
          "en": "Switching interval"
        },
        "default": 7,
        "min": 3,
        "max": 10,
        "step": 1,
        "unit": {
          "zh-hans-cn": "秒",
          "en": "s"
        }
      }
    ],
    "blocks": [
      {
        "type": "image",
        "icon": "image",
        "name": {
          "zh-hans-cn": "图片",
          "en": "Slide"
        },
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            
            "label": {
              "zh-hans-cn": "电脑端图片",
              "en": "Image on PC"
            }
          },
          {
            "type": "image_picker",
            "id": "image_mobile",
            "label": {
              "zh-hans-cn": "移动端图片",
              "en": "Image on mobile device"
            }
          },
          {
            "type": "select",
            "id": "focal_point",
            "label": {
              "zh-hans-cn": "图片展示区域",
              "en": "Image display area"
            },
            "default": "center center",
            "options": [
              {
                "value": "20% 0",
                "label": {
                  "zh-hans-cn": "左上方",
                  "en": "Top left"
                }
              },
              {
                "value": "top center",
                "label": {
                  "zh-hans-cn": "正上方",
                  "en": "Top center"
                }
              },
              {
                "value": "80% 0",
                "label": {
                  "zh-hans-cn": "右上方",
                  "en": "Top right"
                }
              },
              {
                "value": "20% 50%",
                "label": {
                  "zh-hans-cn": "左侧",
                  "en": "Left"
                }
              },
              {
                "value": "center center",
                "label": {
                  "zh-hans-cn": "正中",
                  "en": "Center"
                }
              },
              {
                "value": "80% 50%",
                "label": {
                  "zh-hans-cn": "右侧",
                  "en": "Right"
                }
              },
              {
                "value": "20% 100%",
                "label": {
                  "zh-hans-cn": "左下方",
                  "en": "Bottom left"
                }
              },
              {
                "value": "bottom center",
                "label": {
                  "zh-hans-cn": "正下方",
                  "en": "Bottom center"
                }
              },
              {
                "value": "80% 100%",
                "label": {
                  "zh-hans-cn": "右下方",
                  "en": "Bottom right"
                }
              }
            ]
          },
          {
            "type": "group_header",
            "label": {
              "zh-hans-cn": "文字内容",
              "en": "Text content"
            }
          },
          {
            "type": "text",
            "id": "top_subheading",
            "label": {
              "zh-hans-cn": "副标题",
              "en": "Subtitle"
            }
          },
          {
            "type": "textarea",
            "id": "title",
            "label": {
              "zh-hans-cn": "主标题",
              "en": "Main title"
            },
            "default": "Two Line\nTitle Slide",
            "limit": 500
          },
          {
            "type": "range",
            "id": "title_size",
            "label": {
              "zh-hans-cn": "主标题文字大小",
              "en": "Text size of main title"
            },
            "default": 70,
            "min": 40,
            "max": 100,
            "unit": "px"
          },
          {
            "type": "text",
            "id": "subheading",
            "label": {
              "zh-hans-cn": "正文",
              "en": "Main text"
            },
            "default": "And optional subtext"
          },
          {
            "type": "select",
            "id": "text_align",
            "label": {
              "zh-hans-cn": "文本位置",
              "en": "Text position"
            },
            "default": "vertical-center horizontal-center",
            "options": [
              {
                "value": "vertical-center horizontal-left",
                "label": {
                  "zh-hans-cn": "左侧",
                  "en": "Center left"
                }
              },
              {
                "value": "vertical-center horizontal-center",
                "label": {
                  "zh-hans-cn": "正中",
                  "en": "Center"
                }
              },
              {
                "value": "vertical-center horizontal-right",
                "label": {
                  "zh-hans-cn": "右侧",
                  "en": "Center right"
                }
              },
              {
                "value": "vertical-bottom horizontal-left",
                "label": {
                  "zh-hans-cn": "左下方",
                  "en": "Bottom left"
                }
              },
              {
                "value": "vertical-bottom horizontal-center",
                "label": {
                  "zh-hans-cn": "正下方",
                  "en": "Bottom center"
                }
              },
              {
                "value": "vertical-bottom horizontal-right",
                "label": {
                  "zh-hans-cn": "右下方",
                  "en": "Bottom right"
                }
              }
            ]
          },
          {
            "type": "range",
            "id": "overlay_opacity",
            "label": {
              "zh-hans-cn": "图片遮罩",
              "en": "Image matte"
            },
            "default": 5,
            "min": 0,
            "max": 100,
            "step": 2,
            "unit": "%"
          },
          {
            "type": "group_header",
            "label": {
              "zh-hans-cn": "按钮或图片跳转",
              "en": "Page jumping with button/image"
            },
            "info": {
              "en": "Jumping the page by clicking the image if button texts are not configured",
              "zh-hans-cn": "若没有配置按钮文案，则通过点击图片跳转"
            }
          },
          {
            "type": "text",
            "id": "link_text",
            "label": {
              "zh-hans-cn": "按钮文案",
              "en": "Button text"
            },
            "default": "Shop this"
          },
          {
            "type": "url",
            "id": "link",
            "label": {
              "zh-hans-cn": "跳转链接",
              "en": "Jump link"
            }
          },
          {
            "type": "text",
            "id": "link_text_2",
            "label": {
              "zh-hans-cn": "按钮文案2",
              "en": "Button text 2"
            },
            "default": "Shop all"
          },
          {
            "type": "url",
            "id": "link_2",
            "label": {
              "zh-hans-cn": "跳转链接2",
              "en": "Jump link 2"
            }
          },
          {
            "type": "color_picker",
            "id": "color_accent",
            "label": {
              "zh-hans-cn": "按钮颜色",
              "en": "Button color"
            },
            "default": "rgba(0,0,0,0)"
          }
        ]
      }
    ],
    "presets": [{
      "name": {
        "zh-hans-cn": "轮播图",
        "en": "Slideshow"
      },
      "category":{
        "zh-hans-cn":"内容展示",
        "en": "Content display"
      },
      "settings": {
        "section_height": "natural",
        "mobile_height": "auto",
        "parallax": false,
        "style": "arrows",
        "autoplay": true,
        "autoplay_speed": 7
      },
      "blocks": [
        {
          "type": "image",
          "icon": "image",
          "settings": {
            "image": {},
            "image_mobile": {},
            "focal_point": "center center",
            "title": "Two Line\nTitle Slide",
            "subheading": "And optional subtext",
            "title_size": 70,
            "text_align": "vertical-center horizontal-center",
            "link_text": "Shop this",
            "link_text_2": "Shop all",
            "color_accent": "rgba(0,0,0,0)",
            "overlay_opacity": 5
          }
        },
        {
          "type": "image",
          "icon": "image",
          "settings": {
            "image": {},
            "image_mobile": {},
            "focal_point": "center center",
            "title": "Two Line\nTitle Slide",
            "subheading": "And optional subtext",
            "title_size": 70,
            "text_align": "vertical-center horizontal-center",
            "link_text": "Shop this",
            "link_text_2": "Shop all",
            "color_accent": "rgba(0,0,0,0)",
            "overlay_opacity": 5
          }
        }
      ]
    }]
  }
{{/schema}}